{% if messages %}
{%- if messages[0]['role'] == 'system' %}<|start_header_id|>system<|end_header_id|>
{{ messages[0]['content'] }}<|eot_id|>
{%- else %}<|start_header_id|>system<|end_header_id|>
You are a helpful assistant.<|eot_id|>
{%- endif %}
{%- for message in messages %}
{%- if message['role'] == 'user' %}<|start_header_id|>user<|end_header_id|>
{{ message['content'] }}<|eot_id|>
{%- elif message['role'] == 'assistant' %}<|start_header_id|>assistant<|end_header_id|>
{{ message['content'] }}
{%- if not loop.last %}<|eot_id|>{% endif %}
{%- elif message['role'] == 'system' and not loop.first %}<|start_header_id|>system<|end_header_id|>
{{ message['content'] }}<|eot_id|>
{%- endif %}
{%- endfor %}
{%- if add_generation_prompt %}<|start_header_id|>assistant<|end_header_id|>
{%- endif %}
{%- else %}
<|start_header_id|>system<|end_header_id|>
You are a helpful assistant.<|eot_id|>
{%- if add_generation_prompt %}<|start_header_id|>assistant<|end_header_id|>
{%- endif %}
{%- endif %}